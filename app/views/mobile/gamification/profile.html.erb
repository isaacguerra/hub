<div class="container-fluid p-0 bg-light min-vh-100">
  <!-- Header -->
  <div class="bg-white p-3 shadow-sm mb-3 d-flex align-items-center sticky-top">
    <%= link_to :back, class: "text-decoration-none text-dark me-3" do %>
      <i class="bi bi-arrow-left fs-4"></i>
    <% end %>
    <h5 class="mb-0 fw-bold">Perfil do Campeão</h5>
  </div>

  <div class="px-3 pb-5">
    <!-- Profile Card -->
    <div class="card border-0 shadow-sm rounded-4 mb-4 text-center overflow-hidden">
      <div class="bg-primary p-4 pb-5">
        <img src="<%= Utils::BuscaImagemWhatsapp.buscar(@apoiador.whatsapp) %>" 
             class="rounded-circle border border-4 border-white shadow" 
             style="width: 100px; height: 100px; object-fit: cover; margin-bottom: -50px;"
             onerror="this.src='https://ui-avatars.com/api/?name=<%= @apoiador.name %>&background=random'">
      </div>
      <div class="card-body pt-5 mt-3">
        <h4 class="fw-bold text-dark mb-1"><%= @apoiador.name %></h4>
        <span class="badge bg-warning text-dark rounded-pill px-3 py-2 mb-3 shadow-sm">
          <i class="bi bi-star-fill me-1"></i> Nível <%= @level %>
        </span>
        
        <div class="row g-2 mt-2">
          <div class="col-6">
            <div class="p-3 bg-light rounded-3">
              <h3 class="fw-bold text-primary mb-0"><%= @xp %></h3>
              <small class="text-muted text-uppercase" style="font-size: 0.7rem;">XP Total</small>
            </div>
          </div>
          <div class="col-6">
            <div class="p-3 bg-light rounded-3">
              <h3 class="fw-bold text-warning mb-0"><%= @weekly_wins.count + @challenges_won.count %></h3>
              <small class="text-muted text-uppercase" style="font-size: 0.7rem;">Vitórias</small>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Estratégias de Vitória -->
    <% if @weekly_wins.any? { |w| w.winning_strategy.present? } %>
      <h6 class="fw-bold mb-3 px-2 d-flex align-items-center">
        <i class="bi bi-lightbulb-fill text-warning me-2"></i> Estratégias de Vitória
      </h6>
      <div class="mb-4">
        <% @weekly_wins.select { |w| w.winning_strategy.present? }.each do |win| %>
          <div class="card border-0 shadow-sm rounded-4 mb-3 bg-warning-subtle">
            <div class="card-body position-relative">
              <i class="bi bi-quote position-absolute top-0 start-0 fs-1 text-warning opacity-25 ms-3 mt-2"></i>
              <div class="ps-4 pt-2">
                <p class="fst-italic text-dark mb-3 fw-medium">"<%= win.winning_strategy %>"</p>
                <div class="d-flex justify-content-between align-items-center border-top border-warning border-opacity-25 pt-2">
                  <small class="text-muted">
                    <i class="bi bi-calendar-week me-1"></i>
                    Semana de <%= win.week_end_date.strftime("%d/%m") %>
                  </small>
                  <span class="badge bg-warning text-dark rounded-pill">
                    <%= win.points_total %> XP
                  </span>
                </div>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    <% end %>

    <!-- Conquistas / Badges -->
    <% if @badges.any? %>
      <h6 class="fw-bold mb-3 px-2 d-flex align-items-center">
        <i class="bi bi-award-fill text-primary me-2"></i> Conquistas
      </h6>
      <div class="row g-3 mb-4">
        <% @badges.each do |apoiador_badge| %>
          <div class="col-4 text-center">
            <div class="bg-white p-3 rounded-4 shadow-sm h-100 d-flex flex-column align-items-center justify-content-center">
              <% if apoiador_badge.badge.image_url.present? %>
                <img src="<%= apoiador_badge.badge.image_url %>" class="img-fluid mb-2" style="max-height: 50px;">
              <% else %>
                <i class="bi bi-patch-check-fill fs-1 text-primary mb-2 d-block"></i>
              <% end %>
              <small class="d-block fw-bold text-dark lh-1 mb-1"><%= apoiador_badge.badge.name %></small>
              <% if apoiador_badge.badge.description.present? %>
                <small class="text-muted" style="font-size: 0.65rem; line-height: 1.1;"><%= apoiador_badge.badge.description %></small>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    <% end %>

    <!-- Histórico de Vitórias -->
    <% if @weekly_wins.any? || @challenges_won.any? %>
      
      <% if @weekly_wins.any? %>
        <h6 class="fw-bold mb-3 px-2 d-flex align-items-center">
          <i class="bi bi-trophy-fill text-warning me-2"></i> Campeonatos Semanais
        </h6>
        <div class="card border-0 shadow-sm rounded-4 overflow-hidden mb-4">
          <div class="list-group list-group-flush">
            <% @weekly_wins.each do |win| %>
              <div class="list-group-item p-3 d-flex align-items-center">
                <div class="icon-box warning me-3" style="width: 40px; height: 40px;">
                  <i class="bi bi-trophy-fill"></i>
                </div>
                <div>
                  <h6 class="fw-bold text-dark mb-0">Campeão da Semana</h6>
                  <small class="text-muted"><%= win.week_start_date.strftime("%d/%m") %> a <%= win.week_end_date.strftime("%d/%m") %></small>
                </div>
                <span class="badge bg-warning text-dark ms-auto rounded-pill"><%= win.points_total %> XP</span>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>

      <% if @challenges_won.any? %>
        <h6 class="fw-bold mb-3 px-2 d-flex align-items-center">
          <i class="bi bi-flag-fill text-primary me-2"></i> Missões Conquistadas
        </h6>
        <div class="mb-4">
          <% @challenges_won.each do |challenge| %>
            <div class="card border-0 shadow-sm rounded-4 mb-3">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-start mb-2">
                  <h6 class="fw-bold mb-0 text-dark"><%= challenge.title %></h6>
                  <span class="badge bg-primary rounded-pill">+<%= challenge.reward %> XP</span>
                </div>
                <% if challenge.description.present? %>
                  <p class="text-muted small mb-2"><%= challenge.description %></p>
                <% end %>
                <div class="d-flex align-items-center text-muted small">
                  <i class="bi bi-calendar-event me-1"></i>
                  <%= challenge.starts_at.strftime("%d/%m") %> - <%= challenge.ends_at.strftime("%d/%m") %>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      <% end %>

    <% end %>
  </div>
</div>
