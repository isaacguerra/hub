<div class="container-fluid p-0 bg-light min-vh-100">
  <!-- Header com Status do Jogador -->
  <div class="bg-primary text-white p-4 rounded-bottom-4 shadow-sm mb-4 position-relative overflow-hidden">
    <div class="position-absolute top-0 start-0 w-100 h-100 opacity-10" style="background: radial-gradient(circle, rgba(255,255,255,0.8) 0%, rgba(255,255,255,0) 70%);"></div>
    
    <div class="d-flex align-items-center position-relative z-1">
      <div class="me-3">
        <div class="bg-white text-primary rounded-circle d-flex align-items-center justify-content-center shadow" style="width: 64px; height: 64px; font-size: 1.5rem; font-weight: bold;">
          <%= @my_level %>
        </div>
      </div>
      <div>
        <h5 class="mb-0 fw-bold">Nível <%= @my_level %></h5>
        <div class="d-flex align-items-center mt-1">
          <div class="progress bg-primary-subtle flex-grow-1 me-2" style="height: 8px; width: 120px;">
            <div class="progress-bar bg-warning" role="progressbar" style="width: <%= (@my_xp % 100) %>%;" aria-valuenow="<%= @my_xp %>" aria-valuemin="0" aria-valuemax="100"></div>
          </div>
          <small class="fw-bold"><%= @my_xp %> XP</small>
        </div>
      </div>
    </div>
  </div>

  <div class="px-3 pb-5">
    <h5 class="fw-bold text-dark mb-3 d-flex align-items-center">
      <i class="bi bi-trophy-fill text-warning me-2"></i> Missões Ativas
    </h5>

    <% if @challenges.any? %>
      <div class="row g-3">
        <% @challenges.each do |challenge| %>
          <div class="col-12">
            <div class="card border-0 shadow-sm rounded-4 overflow-hidden h-100">
              <div class="card-body p-0">
                <div class="p-3 bg-white">
                  <div class="d-flex justify-content-between align-items-start mb-2">
                    <h6 class="card-title fw-bold text-primary mb-0"><%= challenge.title %></h6>
                    <span class="badge bg-success-subtle text-success rounded-pill px-3">Ativa</span>
                  </div>
                  
                  <p class="card-text text-muted small mb-3 line-clamp-2">
                    <%= challenge.description %>
                  </p>

                  <div class="d-flex align-items-center mb-3 bg-light rounded-3 p-2">
                    <i class="bi bi-gift-fill text-danger me-2 fs-5"></i>
                    <div>
                      <small class="text-muted d-block" style="font-size: 0.7rem; line-height: 1;">Prêmio</small>
                      <span class="fw-bold text-dark small"><%= challenge.reward %></span>
                    </div>
                  </div>

                  <div class="d-flex justify-content-between align-items-center mt-3">
                    <small class="text-muted">
                      <i class="bi bi-clock me-1"></i>
                      Fim: <%= challenge.ends_at.strftime("%d/%m") %>
                    </small>
                    <%= link_to mobile_gamification_path(challenge), class: "btn btn-sm btn-primary rounded-pill px-4 fw-bold" do %>
                      Ver Detalhes <i class="bi bi-arrow-right ms-1"></i>
                    <% end %>
                  </div>
                </div>
                
                <!-- Barra de Progresso Visual (Decorativa se não tiver dados reais ainda) -->
                <div class="progress" style="height: 4px;">
                  <div class="progress-bar bg-info" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <div class="text-center py-5">
        <div class="mb-3 text-muted opacity-50">
          <i class="bi bi-controller" style="font-size: 4rem;"></i>
        </div>
        <h6 class="text-muted fw-bold">Nenhuma missão ativa no momento.</h6>
        <p class="small text-muted">Fique ligado, novos desafios em breve!</p>
      </div>
    <% end %>
  </div>
</div>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
